# EchoVault Docker Compose
# Run EchoVault with X11 forwarding on unsupported Linux distributions

services:
  echovault:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: echovault

    # X11 forwarding configuration
    environment:
      - DISPLAY=${DISPLAY:-:0}
      - XAUTHORITY=/tmp/.Xauthority
      # D-Bus for notifications
      - DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus

    volumes:
      # X11 socket for display
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ${XAUTHORITY:-$HOME/.Xauthority}:/tmp/.Xauthority:ro

      # D-Bus socket for notifications
      - /run/user/1000/bus:/run/user/1000/bus:ro

      # Persistent data
      - echovault-config:/home/echovault/.config/echovault
      - echovault-data:/home/echovault/.local/share/echovault

      # Rclone config (if using system rclone config)
      - ${HOME}/.config/rclone:/home/echovault/.config/rclone:ro

    # Network mode for D-Bus access
    network_mode: host

    # Security options
    security_opt:
      - seccomp:unconfined

    # IPC for shared memory (required for some GUI apps)
    ipc: host

    # Device access for GPU acceleration (optional)
    devices:
      - /dev/dri:/dev/dri

    # Restart policy
    restart: unless-stopped

volumes:
  echovault-config:
    name: echovault-config
  echovault-data:
    name: echovault-data
