# Mise configuration for EchoVault
# https://mise.jdx.dev/
#
# Setup: mise run setup

[tools]
node = "24"
python = "3.13"
rust = "stable"
pnpm = "latest"
uv = "latest"

[settings]
trusted_config_paths = ["."]

[tasks.setup]
description = "Setup development environment"
run = [
  "mise install",
  "pnpm install",
  "node scripts/download-rclone.mjs",
  "node scripts/download-crsqlite.mjs",
  "node scripts/build-rust.mjs",
  "node scripts/clean-venv.mjs",
  "uv pip install pre-commit",
  "uv run pre-commit install",
  "echo 'Setup complete!'",
]

[tasks.lint]
description = "Run all quality checks (cargo + biome + tsc)"
run = [
  "cargo fmt --all -- --check",
  "cargo clippy -p echovault-core -- -D warnings",
  "cd apps/web && pnpm typecheck && pnpm lint",
]

[tasks.test]
description = "Run tests"
run = "cargo test -p echovault-core"

[tasks.fix]
description = "Auto-fix formatting issues"
run = [
  "cargo fmt --all",
  "cd apps/web && pnpm exec biome check --write src",
]
